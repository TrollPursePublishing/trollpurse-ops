AWSTemplateFormatVersion: 2010-09-09
Transform: AWS::Serverless-2016-10-31
Parameters:
  GithubOrganization:
    Type: String
    Description: Name of the organization on Github for access
  GithubRepositoryName:
    Type: String
    Description: Name of the repository this lfs configuration.
  BigWindowsContainerBuilder:
    Type: String
    AllowedValues:
      - Yes
      - No
    Description: Add support for serverless pipeline custom action to build large windows docker images?
    ConstraintDescription: Yes or No
  UE4Support:
    Type: String
    AllowedValues:
      - Yes
      - No
    Description: Should the pre-requisites be deployed that enable UE4 support?
    ConstraintDescription: Yes or No
  GitLfsServerless:
    Type: String
    AllowedValues:
      - Yes
      - No
    Description: Deploy your own Git LFS serverless API for asset heavy projects?
    ConstraintDescription: Yes or No
Conditions:
  BuildUE4Stuff:
    !Equals [ !Ref UE4Support, Yes ]
  BuildWindowsContainerStuff:
    !Or [!Equals [ !Ref BigWindowsContainerBuilder, Yes ], Condition: BuildUE4Stuff ]
  BuildGitLfsServerless:
    !Equals [ !Ref GitLfsServerless, Yes ]
Resources:
  ArtifactStores:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: /templates/common/ops-storage.yml
  
  ContainerRepository:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: /templates/common/ops-ecr.yml
  
  PipelineRoles:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: /templates/common/ops-iam.yml
    
  GitLFSServerless:
    Type: AWS::CloudFormation::Stack
    Condition: BuildGitLfsServerless
    Properties:
      TemplateURL: /templates/bootstrap/bootstrap-git-lfs-serverless.yml
      
  WindowsContainerBuilder:
    Type: AWS::CloudFormation::Stack
    Condition: BuildWindowsContainerStuff
    Properties:
      TemplateURL: /templates/bootstrap/bootstrap-fat-container-build.yml
      
  UE4ContainerPipeline:
    Type: AWS::CloudFormation::Stack
    Condition: BuildUE4Stuff
    Properties:
      TemplateURL: /templates/bootstrap/ue4/bootstrap-ue4-container-builder.yml